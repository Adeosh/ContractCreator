<UserControl xmlns="https://github.com/avaloniaui"
			 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
			 xmlns:vm="using:ContractCreator.UI.ViewModels.Counterparties"
			 xmlns:controls="using:ContractCreator.UI.Views.UserControls"
			 xmlns:dto="using:ContractCreator.Shared.DTOs"
			 x:Class="ContractCreator.UI.Views.Counterparties.CounterpartyEditorView"
			 x:DataType="vm:CounterpartyEditorViewModel"
			 x:Name="Root">

	<ScrollViewer>
		<StackPanel Margin="20" Spacing="15" MaxWidth="850">

			<StackPanel Orientation="Horizontal" Spacing="10" Margin="0,0,0,10">
				<Button Command="{Binding CancelCommand}" Content="🠔" ToolTip.Tip="Назад" Classes="windowBtn"/>
				<TextBlock Text="Карточка контрагента" FontSize="22" FontWeight="Bold" VerticalAlignment="Center"/>
			</StackPanel>

			<Border Background="{DynamicResource CardBrush}" CornerRadius="8" Padding="15" BoxShadow="0 1 3 0 #20000000">
				<StackPanel Spacing="15">
					<TextBlock Text="Правовой статус" FontWeight="Bold" FontSize="16" Foreground="{DynamicResource PrimaryTextColor}"/>

					<StackPanel Spacing="5" HorizontalAlignment="Left" Width="400">
						<TextBlock Text="Правовая форма" FontSize="12" Foreground="{DynamicResource SecondaryTextBrush}"/>
						<ComboBox ItemsSource="{Binding LegalForms}"
								  SelectedItem="{Binding SelectedLegalForm}"
								  HorizontalAlignment="Stretch">
							<ComboBox.ItemTemplate>
								<DataTemplate>
									<TextBlock Text="{Binding Converter={StaticResource EnumDescConverter}}"/>
								</DataTemplate>
							</ComboBox.ItemTemplate>
						</ComboBox>
					</StackPanel>
				</StackPanel>
			</Border>

			<Border Background="{DynamicResource CardBrush}" CornerRadius="8" Padding="15" BoxShadow="0 1 3 0 #20000000">
				<StackPanel Spacing="15">
					<TextBlock Text="Наименование" FontWeight="Bold" FontSize="16" Foreground="{DynamicResource PrimaryTextColor}"/>

					<Grid ColumnDefinitions="*, 15, 2*">
						<StackPanel Grid.Column="0" Spacing="5">
							<TextBlock Text="Краткое наименование" FontSize="12" Foreground="{DynamicResource SecondaryTextBrush}"/>
							<TextBox Text="{Binding ShortName}" Watermark="ООО 'Ромашка'" Classes="outline"/>
						</StackPanel>

						<StackPanel Grid.Column="2" Spacing="5">
							<TextBlock Text="Полное наименование" FontSize="12" Foreground="{DynamicResource SecondaryTextBrush}"/>
							<TextBox Text="{Binding FullName}" ToolTip.Tip="{Binding FullName}" Classes="outline"/>
						</StackPanel>
					</Grid>
				</StackPanel>
			</Border>

			<Border Background="{DynamicResource CardBrush}" CornerRadius="8" Padding="15" BoxShadow="0 1 3 0 #20000000">
				<StackPanel Spacing="15">
					<TextBlock Text="Регистрационные данные" FontWeight="Bold" FontSize="16" Foreground="{DynamicResource PrimaryTextColor}"/>

					<Grid ColumnDefinitions="*, 10, *, 10, *">
						<StackPanel Grid.Column="0" Spacing="5">
							<TextBlock Text="ИНН" FontSize="12" Foreground="{DynamicResource SecondaryTextBrush}"/>
							<TextBox Text="{Binding Inn}" Classes="outline"/>
						</StackPanel>
						<StackPanel Grid.Column="2" Spacing="5">
							<TextBlock Text="КПП" FontSize="12" Foreground="{DynamicResource SecondaryTextBrush}"/>
							<TextBox Text="{Binding Kpp}" Classes="outline"/>
						</StackPanel>
						<StackPanel Grid.Column="4" Spacing="5">
							<TextBlock Text="ОГРН" FontSize="12" Foreground="{DynamicResource SecondaryTextBrush}"/>
							<TextBox Text="{Binding Ogrn}" Classes="outline"/>
						</StackPanel>
					</Grid>

					<Grid ColumnDefinitions="*, 10, *, 10, *">
						<StackPanel Grid.Column="0" Spacing="5">
							<TextBlock Text="ОКТМО" FontSize="12" Foreground="{DynamicResource SecondaryTextBrush}"/>
							<TextBox Text="{Binding Oktmo}" Classes="outline"/>
						</StackPanel>
						<StackPanel Grid.Column="2" Spacing="5">
							<TextBlock Text="ОКПО" FontSize="12" Foreground="{DynamicResource SecondaryTextBrush}"/>
							<TextBox Text="{Binding Okpo}" Classes="outline"/>
						</StackPanel>
						<StackPanel Grid.Column="4"/> </Grid>
				</StackPanel>
			</Border>

			<Border Background="{DynamicResource CardBrush}" CornerRadius="8" Padding="15" BoxShadow="0 1 3 0 #20000000">
				<StackPanel Spacing="20">
					<TextBlock Text="Контакты и Адреса" FontWeight="Bold" FontSize="16" Foreground="{DynamicResource PrimaryTextColor}"/>

					<Grid ColumnDefinitions="*, 15, *">
						<StackPanel Grid.Column="0" Spacing="5">
							<TextBlock Text="Телефон" FontSize="12" Foreground="{DynamicResource SecondaryTextBrush}"/>
							<MaskedTextBox Mask="+7 (000) 000-00-00" Text="{Binding Phone}" Classes="outline" HidePromptOnLeave="True"/>
						</StackPanel>
						<StackPanel Grid.Column="2" Spacing="5">
							<TextBlock Text="Email" FontSize="12" Foreground="{DynamicResource SecondaryTextBrush}"/>
							<TextBox Text="{Binding Email}" Classes="outline"/>
						</StackPanel>
					</Grid>

					<Separator Background="{DynamicResource BorderBrush}" Opacity="0.3"/>

					<StackPanel Spacing="5">
						<TextBlock Text="Юридический адрес" FontWeight="SemiBold"/>
						<controls:AddressControl DataContext="{Binding LegalAddressVM}"/>
					</StackPanel>

					<StackPanel Spacing="5">
						<TextBlock Text="Фактический адрес" FontWeight="SemiBold"/>
						<controls:AddressControl DataContext="{Binding ActualAddressVM}"/>
					</StackPanel>
				</StackPanel>
			</Border>

			<Border Background="{DynamicResource CardBrush}" CornerRadius="8" Padding="15" BoxShadow="0 1 3 0 #20000000">
				<StackPanel Spacing="15">
					<Grid ColumnDefinitions="*, Auto">
						<TextBlock Text="Контактные лица" FontWeight="Bold" FontSize="16" Foreground="{DynamicResource PrimaryTextColor}" VerticalAlignment="Center"/>

						<Button Grid.Column="1"
								Command="{Binding AddContactCommand}"
								Classes="accent small">
							<TextBlock Text="+ Добавить контакт" FontWeight="Bold"/>
						</Button>
					</Grid>

					<DataGrid ItemsSource="{Binding Contacts}"
							  SelectedItem="{Binding SelectedContact}"
							  AutoGenerateColumns="False"
							  IsReadOnly="True"
							  MinHeight="100" MaxHeight="250"
							  GridLinesVisibility="Horizontal"
							  BorderThickness="1" BorderBrush="#E0E0E0">

						<DataGrid.Columns>
							<DataGridTextColumn Header="Фамилия" Binding="{Binding LastName}" Width="*" />
							<DataGridTextColumn Header="Имя" Binding="{Binding FirstName}" Width="*" />
							<DataGridTextColumn Header="Должность" Binding="{Binding Position}" Width="150" />
							<DataGridTextColumn Header="Телефон" Binding="{Binding Phone}" Width="150" />

							<DataGridTemplateColumn Header="Действия" Width="Auto">
								<DataGridTemplateColumn.CellTemplate>
									<DataTemplate DataType="dto:ContactDto">
										<StackPanel Orientation="Horizontal" Spacing="10">

											<Button Command="{ReflectionBinding #Root.DataContext.EditContactCommand}"
													CommandParameter="{Binding}"
													Background="Transparent"
													ToolTip.Tip="Редактировать">
												<TextBlock Text="✏️" Foreground="Orange"/>
											</Button>

											<Button Command="{ReflectionBinding #Root.DataContext.DeleteContactCommand}"
													CommandParameter="{Binding}"
													Background="Transparent"
													ToolTip.Tip="Удалить">
												<TextBlock Text="❌" Foreground="Red"/>
											</Button>

										</StackPanel>
									</DataTemplate>
								</DataGridTemplateColumn.CellTemplate>
							</DataGridTemplateColumn>
						</DataGrid.Columns>
					</DataGrid>

					<TextBlock Text="Нет добавленных контактов"
							   IsVisible="{Binding !Contacts.Count}"
							   HorizontalAlignment="Center" Foreground="Gray"/>
				</StackPanel>
			</Border>

			<Border Background="{DynamicResource CardBrush}" CornerRadius="8" Padding="15" BoxShadow="0 1 3 0 #20000000">
				<StackPanel Spacing="20">
					<TextBlock Text="Банковские реквизиты" FontWeight="Bold" FontSize="16" Foreground="{DynamicResource PrimaryTextColor}"/>
					<controls:BankAccountsControl DataContext="{Binding BankAccountVM}"/>
				</StackPanel>
			</Border>

			<Expander Header="Дополнительная информация" HorizontalAlignment="Stretch" Background="{DynamicResource CardBrush}" CornerRadius="8">
				<TextBox Text="{Binding ExtraInformation}" Classes="outline" AcceptsReturn="True" TextWrapping="Wrap" MinHeight="60"/>
			</Expander>

			<Border Background="{DynamicResource CardBrush}" CornerRadius="8" Padding="15" BoxShadow="0 1 3 0 #20000000">
				<StackPanel Spacing="15">
					<TextBlock Text="Документы контрагента" FontWeight="Bold" FontSize="16" Foreground="{DynamicResource PrimaryTextColor}"/>
					<controls:AttachedFilesControl DataContext="{Binding AttachedFilesVM}"/>
				</StackPanel>
			</Border>

			<StackPanel Orientation="Horizontal" Spacing="20" HorizontalAlignment="Right" Margin="0,10,0,50">
				<Button Command="{Binding CancelCommand}" Content="Отмена"/>
				<Button Command="{Binding SaveCommand}" Content="Сохранить изменения" Classes="accent" FontWeight="Bold" Padding="25,10"/>
			</StackPanel>

		</StackPanel>
	</ScrollViewer>
</UserControl>