<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:ContractCreator.UI.ViewModels"
        x:Class="ContractCreator.UI.Views.MainWindow"
        x:DataType="vm:MainWindowViewModel"
        Title="Актум"     
        Width="1920" Height="1080"
        MinWidth="1024" MinHeight="768"
        WindowStartupLocation="CenterScreen"      
        SystemDecorations="Full"
        ExtendClientAreaToDecorationsHint="True"
        ExtendClientAreaChromeHints="NoChrome"
        ExtendClientAreaTitleBarHeightHint="-1"
        Background="Transparent">

    <Border BorderThickness="1" 
            BorderBrush="{DynamicResource WindowBorderBrush}"
            CornerRadius="10"
            Background="{DynamicResource RegionBrush}" 
            ClipToBounds="True"
            Margin="5"
            BoxShadow="0 0 10 0 #40000000">
        
        <Grid RowDefinitions="Auto, *">
            
            <Grid Grid.Row="0" 
                  ColumnDefinitions="1*, Auto, 1*" 
                  Height="45" 
                  Background="Transparent"
                  PointerPressed="OnTitleBarPointerPressed">
                
                <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="20,0,0,0" Spacing="15" HorizontalAlignment="Left">
                    <TextBlock Text="📄 Актум" FontWeight="Bold" FontSize="18" VerticalAlignment="Center" Foreground="{DynamicResource ActionBrush}"/>
                    
                    <Border Width="1" Height="20" Background="{DynamicResource BorderBrush}" VerticalAlignment="Center"/>

                    <TextBlock Text="{Binding CurrentFirmName}" 
                               FontWeight="SemiBold" 
                               FontSize="14" 
                               VerticalAlignment="Center"
                               Foreground="{DynamicResource PrimaryTextBrush}"
                               ToolTip.Tip="Текущая рабочая фирма"/>
                </StackPanel>

                <Menu Grid.Column="1" 
                      ItemsSource="{Binding MenuItems}" 
                      VerticalAlignment="Top"> </Menu>
                
                <StackPanel Grid.Column="2" Orientation="Horizontal" Margin="0,0,10,0" HorizontalAlignment="Right">
                    
                    					<Button Classes="windowBtn"
							Command="{Binding OpenSettingsCommand}"
							Content="⚙️"
							ToolTip.Tip="Настройки"
							Margin="0,0,15,0"
							Background="Transparent"
							BorderThickness="0"
							CornerRadius="15">
						<Button.Flyout>
							<Flyout Placement="BottomEdgeAlignedRight">
								<StackPanel Width="350" Spacing="15" Margin="10">
									<TextBlock Text="⚙️ Настройки" FontWeight="Bold" FontSize="18" Foreground="{DynamicResource ActionBrush}"/>

									<Separator Background="{DynamicResource BorderBrush}" Margin="0,-5,0,0"/>

									<StackPanel Spacing="5">
										<TextBlock Text="Текущая рабочая фирма:" FontWeight="SemiBold" Foreground="{DynamicResource SecondaryTextBrush}"/>
										<ComboBox ItemsSource="{Binding AvailableFirms}"
												  SelectedItem="{Binding SelectedFirm}"
												  DisplayMemberBinding="{Binding ShortName}"
												  HorizontalAlignment="Stretch"
												  PlaceholderText="Выберите фирму..."/>
									</StackPanel>

									<StackPanel Spacing="5">
										<TextBlock Text="Ответственный сотрудник:" FontWeight="SemiBold" Foreground="{DynamicResource SecondaryTextBrush}"/>
										<ComboBox ItemsSource="{Binding AvailableWorkers}"
												  SelectedItem="{Binding SelectedWorker}"
												  DisplayMemberBinding="{Binding FullName}"
												  HorizontalAlignment="Stretch"
												  PlaceholderText="Выберите сотрудника..."
												  IsEnabled="{Binding SelectedFirm, Converter={x:Static ObjectConverters.IsNotNull}}"/>
									</StackPanel>

									<StackPanel Spacing="5">
										<TextBlock Text="Папка хранилища файлов:" FontWeight="SemiBold" Foreground="{DynamicResource SecondaryTextBrush}"/>
										<Grid ColumnDefinitions="*, Auto">
											<TextBox Grid.Column="0"
													 Text="{Binding StoragePath}"
													 IsReadOnly="True"
													 Margin="0,0,5,0"
													 ToolTip.Tip="{Binding StoragePath}"/>
											<Button Grid.Column="1"
													Content="..."
													Command="{Binding ChangeStoragePathCommand}"
													Classes="outline"/>
										</Grid>
									</StackPanel>

									<Separator Background="{DynamicResource BorderBrush}" Margin="0,5"/>

									<Button Content="Сверка файлов с БД"
											Command="{Binding CheckFilesCommand}"
											HorizontalAlignment="Stretch"
											Classes="outline"/>
								</StackPanel>
							</Flyout>
						</Button.Flyout>
					</Button>

                    <ToggleSwitch IsChecked="{Binding IsDarkTheme}" 
                                  OnContent="🌙" OffContent="☀️"
                                  Margin="0,0,15,0"/>

                    <Button Classes="windowBtn" Click="Minimize_Click" Content="—"/>
                    <Button Classes="windowBtn" Click="Maximize_Click" Content="☐"/>
                    <Button Classes="windowBtn closeBtn" Click="Close_Click" Content="✕"/>
                </StackPanel>
            </Grid>

            <Grid Grid.Row="1" Background="{DynamicResource RegionBrush}">
                <ContentControl Content="{Binding CurrentPage}" Margin="20"/>
            </Grid>

        </Grid>
    </Border>

</Window>